/*
icErpZXY 的部署脚本
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, QUOTED_IDENTIFIER ON;

SET CONCAT_NULL_YIELDS_NULL, NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "icErpZXY"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\DATA\"

GO
USE [master]

GO
:on error exit
GO
USE [$(DatabaseName)]

GO
IF EXISTS (SELECT * FROM tempdb..sysobjects WHERE id=OBJECT_ID('tempdb..#tmpErrors')) DROP TABLE #tmpErrors
GO
CREATE TABLE #tmpErrors (Error int)
GO
SET XACT_ABORT ON
GO
SET TRANSACTION ISOLATION LEVEL READ COMMITTED
GO
BEGIN TRANSACTION
GO
PRINT N'正在删除 [dbo].[func_RegexIsMatch]...';


GO
DROP FUNCTION [dbo].[func_RegexIsMatch];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[func_RegexMatch]...';


GO
DROP FUNCTION [dbo].[func_RegexMatch];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[func_RegexReplace]...';


GO
DROP FUNCTION [dbo].[func_RegexReplace];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[GetRegexMatchGroups]...';


GO
DROP FUNCTION [dbo].[GetRegexMatchGroups];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[func_DelFile]...';


GO
DROP FUNCTION [dbo].[func_DelFile];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[func_FileIsExists]...';


GO
DROP FUNCTION [dbo].[func_FileIsExists];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[func_ReadFile]...';


GO
DROP FUNCTION [dbo].[func_ReadFile];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[func_SaveFile]...';


GO
DROP FUNCTION [dbo].[func_SaveFile];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[func_CreatePath]...';


GO
DROP FUNCTION [dbo].[func_CreatePath];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[func_DeletePath]...';


GO
DROP FUNCTION [dbo].[func_DeletePath];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[func_GetFileCountOfPath]...';


GO
DROP FUNCTION [dbo].[func_GetFileCountOfPath];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[func_IsPathFull]...';


GO
DROP FUNCTION [dbo].[func_IsPathFull];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[func_LastIndexOf]...';


GO
DROP FUNCTION [dbo].[func_LastIndexOf];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [dbo].[func_PathIsExists]...';


GO
DROP FUNCTION [dbo].[func_PathIsExists];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在删除 [icErp.CLR]...';


GO
DROP ASSEMBLY [icErp.CLR];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [icErp.CLR]...';


GO
CREATE ASSEMBLY [icErp.CLR]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103005C8DA1520000000000000000E00002210B0108000012000000060000000000004E310000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000F830000053000000004000007003000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000054110000002000000012000000020000000000000000000000000000200000602E7273726300000070030000004000000004000000140000000000000000000000000000400000402E72656C6F6300000C000000006000000002000000180000000000000000000000000000400000420000000000000000000000000000000030310000000000004800000002000500A0240000580C000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B3003002D00000001000011160A02280E00000A2D2103280E00000A2D1902031F0A280F00000A0B076F1000000A2C02170ADE0326DE00062A000000011000000000120016280003010000011B30030036000000020000117E1100000A0A02280E00000A2D2603280E00000A2D1E02031F0A280F00000A0B076F1000000A2C07076F1200000A0ADE0326DE00062A000001100000000016001B310003010000011B3003003700000002000011020A02280E00000A2D2B03280E00000A2D23042C2002031F0A280F00000A0B076F1000000A2C09060304281300000A0ADE0326DE00062A0001100000000015001D320003010000011B3003006C000000030000117E1100000A0A02280E00000A2D5A03280E00000A2D5202031F0B280F00000A0B076F1000000A2C3504076F1400000A6F1500000A2F27076F1400000A046F1600000A6F1200000A0A066F1700000A05310A0616056F1800000A2B01060ADE09267E1100000A0CDE02062A082A0110000000001600495F000901000001133002001C00000004000011150A02280E00000A2D1003280E00000A2D0802036F1900000A0A062A1E02281A00000A2A1B300400B200000005000011030A042D067E1100000A2A02281B00000A2D0702281C00000A26160B2B4F0717580B031F2E6F1D00000A0C08152E270316086F1800000A7201000070078C18000001281E00000A03086F1F00000A282000000A0A2B17037201000070078C18000001281E00000A282100000A0A02720D00007006282000000A282200000A2D9E02720D00007006282000000A17732300000A0D090416048E696F2400000A096F2500000ADE0A092C06096F2600000ADC062A0000011000000200930013A6000A000000001B3003002F00000006000011170A02720D00007003282000000A282200000A2C1102720D00007003282000000A282700000ADE0526160ADE00062A00011000000000020026280005010000011B3003001E00000006000011160A02720D00007003282000000A282200000A2C02170ADE0326DE00062A0000011000000000020017190003010000011B3004006500000007000011140A02720D00007003282000000A282200000A2C4E02720D00007003282000000A19732300000A0B076F2800000AD48D1E0000010A076F2800000A0C07166A166F2900000A2607061608696F2A00000A26076F2500000ADE0A072C06076F2600000ADC062A00000001100000020028003159000A000000001E02281B00000A2A1B3001001C00000006000011160A02281B00000A2D0E02281C00000A26170ADE0526DE02170A062A0110000000000A000B150003010000011B3002001A00000006000011160A02281B00000A2C0E0203282B00000A170ADE0326DE00062A00000110000000000A000B150003010000011B3001001C00000008000011160A02281B00000A2C0B02282C00000A0B078E690ADE0326DE00062A011000000000020015170003010000013602280E00000603FE0416FE012A1E02281A00000A2A000042534A4201000100000000000C00000076322E302E35303732370000000005006C000000B8040000237E000024050000F804000023537472696E6773000000001C0A00001400000023555300300A0000100000002347554944000000400A00001802000023426C6F620000000000000002000001471502000900000000FA253300160000010000001F00000003000000100000001D0000002C0000001800000008000000010000000300000000000A00010000000000060045003E000600B701A5010600CE01A5010600EB01A50106000A02A50106002302A50106003C02A50106005702A50106007202A5010600AA028B020600BE02A5010600F702D70206001703D7020A005C034103060071033E000E00A50386030E00AB0386030E00B10386030E00BE0386030E00D60386030E00F0038603060049043F0406005A043F04060078043E0006008C043F04060091043F0406009C043F040600A5043F040600B8043E000600D3043E000600D8043F0400000000010000000000010001000100100018001F000500010001000100100029001F0005000100070050200000000096004C000A0001009C200000000096005E0010000300F0200000000096006E0016000500442100000000960080001D000800CC21000000009600940025000C00F421000000008618A5002B000E00FC21000000009600AB002F000E00CC22000000009600B9000A0011001823000000009600C6000A0013005423000000009600D80037001500D823000000009600E6003E001700E023000000009600F8003E00180018240000000096000801430019005024000000009600180149001B00882400000000960030014E001C009624000000008618A5002B001E00000001004001000002004601000001004001000002004601000001004001000002004601000003004E01000001004001000002004601000003005901000004006101000001004001000002007101000001007801000002008201000003008B01000001007801000002008201000001007801000002008201000001007801000002008201000001007801000001007801000001007801000002009001000001007801000001007801000002009F011100A50054001900A50054002100A50054002900A50054003100A50054003900A50054004100A50054004900A50054005100A50059005900A50054006100A5005E006900A5002B007100A5002B00790078033E008100AB0368009900C40371007900D0037B00A100DE037E008100E8031600890000048800A9000B048D00A9001504910079001E048D0079002904970079003304A4000900A5002B00B10053043E00B1006804510179003304570179007E045C01790029046201790085041600790085041000C90053043E00D100A5006701E100AC046E01E100B2042B00E900C4042B00C900CC047E01E1001E048701E100E3048B01E100E8049201B100CC04A201B100ED04A80120006B0063002E004B00C3012E006300F8012E003B00C3012E005B00EF012E001B00C3012E003300D3012E001300C3012E000B00B4012E002300C9012E002B00B40140006B00630060006B00630080006B006300A0006B006300E0006B00AD0000016B00AD0020016B00AD0040016B00AD0060016B00AD0080016B00AD00A0016B00AD00C0016B00AD00E0016B00AD00750082009D00A900760183019A01AE010480000001000000E0132E750000000000001F0000000200000000000000000000000100350000000000020000000000000000000000010035030000000002000000000000000000000001003E00000000000000003C4D6F64756C653E0069634572702E434C522E646C6C005265676578730069634572702E434C520046696C654F706572617465006D73636F726C69620053797374656D004F626A6563740066756E635F526567657849734D617463680066756E635F52656765784D617463680066756E635F52656765785265706C6163650047657452656765784D6174636847726F7570730066756E635F4C617374496E6465784F66002E63746F720066756E635F5361766546696C650066756E635F44656C46696C650066756E635F46696C6549734578697374730066756E635F5265616446696C650066756E635F5061746849734578697374730066756E635F437265617465506174680066756E635F44656C657465506174680066756E635F47657446696C65436F756E744F66506174680066756E635F49735061746846756C6C00696E707574007061747465726E007265706C6163655374720067726F75704964006D617852657475726E4C656E67746800737562737472006469726563746F72790066696C654E616D650066696C6500697344656C65746553756244697200636F756E740053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C747572654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E4174747269627574650053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053797374656D2E44617461004D6963726F736F66742E53716C5365727665722E5365727665720053716C46756E6374696F6E41747472696275746500537472696E670049734E756C6C4F72456D7074790053797374656D2E546578742E526567756C617245787072657373696F6E73005265676578004D617463680052656765784F7074696F6E730047726F7570006765745F5375636365737300456D7074790043617074757265006765745F56616C7565005265706C6163650047726F7570436F6C6C656374696F6E006765745F47726F757073006765745F436F756E74006765745F4974656D006765745F4C656E67746800537562737472696E67004C617374496E6465784F660053797374656D2E494F004469726563746F727900457869737473004469726563746F7279496E666F004372656174654469726563746F727900496E74333200466F726D617400436F6E6361740046696C650046696C6553747265616D0046696C654D6F64650053747265616D00577269746500436C6F73650049446973706F7361626C6500446973706F73650044656C6574650042797465005365656B4F726967696E005365656B00526561640047657446696C6573000000000B28007B0030007D00290000035C0000000000FB83B6D3302351438E51ED7F1D3D5B240008B77A5C561934E089050002020E0E0500020E0E0E0600030E0E0E0E0700040E0E0E0808050002080E0E032000010700030E0E0E1D050600021D050E0E040001020E050002020E02040001080E050002020E08042001010E04200101020420010108040100000008000312450E0E11490320000205070202124502060E0320000E0507020E1245042000125503200008052001124D080520020E08080607030E12450E042001080E0307010880A20100020054020F497344657465726D696E6973746963015455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A4461746141636365737300000000050001125D0E04200108030500020E0E1C0420010E08062002010E116D072003011D0508080707040E08081269040001010E030701020320000A0620020A0A117D072003081D0508080707031D0512690A050002010E020500011D0E0E050702081D0E0E01000969634572702E434C520000050100000000090100046871657700001B010016436F7079726967687420C2A92068716577203230313200000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301002031000000000000000000003E3100000020000000000000000000000000000000000000000000003031000000000000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF25002040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000140300000000000000000000140334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000001002E75E013000001002E75E0133F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00474020000010053007400720069006E006700460069006C00650049006E0066006F0000005002000001003000300030003000300034006200300000002C000500010043006F006D00700061006E0079004E0061006D006500000000006800710065007700000000003C000A000100460069006C0065004400650073006300720069007000740069006F006E0000000000690063004500720070002E0043004C005200000040000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0035003000380038002E0032003900390039003800000000003C000E00010049006E007400650072006E0061006C004E0061006D0065000000690063004500720070002E0043004C0052002E0064006C006C0000005000160001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A9002000680071006500770020003200300031003200000044000E0001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000690063004500720070002E0043004C0052002E0064006C006C00000034000A000100500072006F0064007500630074004E0061006D00650000000000690063004500720070002E0043004C005200000044000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0035003000380038002E00320039003900390038000000000048000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0035003000380038002E00320039003900390038000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000503100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    WITH PERMISSION_SET = EXTERNAL_ACCESS;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_RegexIsMatch]...';


GO
CREATE FUNCTION [dbo].[func_RegexIsMatch]
(@input NVARCHAR (4000), @pattern NVARCHAR (4000))
RETURNS BIT
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.Regexs].[func_RegexIsMatch]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_RegexMatch]...';


GO
CREATE FUNCTION [dbo].[func_RegexMatch]
(@input NVARCHAR (4000), @pattern NVARCHAR (4000))
RETURNS NVARCHAR (4000)
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.Regexs].[func_RegexMatch]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_RegexReplace]...';


GO
CREATE FUNCTION [dbo].[func_RegexReplace]
(@input NVARCHAR (4000), @pattern NVARCHAR (4000), @replaceStr NVARCHAR (4000))
RETURNS NVARCHAR (4000)
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.Regexs].[func_RegexReplace]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[GetRegexMatchGroups]...';


GO
CREATE FUNCTION [dbo].[GetRegexMatchGroups]
(@input NVARCHAR (4000), @pattern NVARCHAR (4000), @groupId INT, @maxReturnLength INT)
RETURNS NVARCHAR (4000)
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.Regexs].[GetRegexMatchGroups]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_DelFile]...';


GO
CREATE FUNCTION [dbo].[func_DelFile]
(@directory NVARCHAR (4000), @fileName NVARCHAR (4000))
RETURNS BIT
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.FileOperate].[func_DelFile]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_FileIsExists]...';


GO
CREATE FUNCTION [dbo].[func_FileIsExists]
(@directory NVARCHAR (4000), @fileName NVARCHAR (4000))
RETURNS BIT
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.FileOperate].[func_FileIsExists]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_ReadFile]...';


GO
CREATE FUNCTION [dbo].[func_ReadFile]
(@directory NVARCHAR (4000), @fileName NVARCHAR (4000))
RETURNS VARBINARY (max)
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.FileOperate].[func_ReadFile]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_SaveFile]...';


GO
CREATE FUNCTION [dbo].[func_SaveFile]
(@directory NVARCHAR (4000), @fileName NVARCHAR (4000), @file VARBINARY (8000))
RETURNS NVARCHAR (max)
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.FileOperate].[func_SaveFile]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_CreatePath]...';


GO
CREATE FUNCTION [dbo].[func_CreatePath]
(@directory NVARCHAR (4000))
RETURNS BIT
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.FileOperate].[func_CreatePath]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_DeletePath]...';


GO
CREATE FUNCTION [dbo].[func_DeletePath]
(@directory NVARCHAR (4000), @isDeleteSubDir BIT)
RETURNS BIT
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.FileOperate].[func_DeletePath]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_GetFileCountOfPath]...';


GO
CREATE FUNCTION [dbo].[func_GetFileCountOfPath]
(@directory NVARCHAR (4000))
RETURNS INT
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.FileOperate].[func_GetFileCountOfPath]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_IsPathFull]...';


GO
CREATE FUNCTION [dbo].[func_IsPathFull]
(@directory NVARCHAR (4000), @count INT)
RETURNS BIT
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.FileOperate].[func_IsPathFull]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_LastIndexOf]...';


GO
CREATE FUNCTION [dbo].[func_LastIndexOf]
(@input NVARCHAR (4000), @substr NVARCHAR (4000))
RETURNS INT
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.Regexs].[func_LastIndexOf]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'正在创建 [dbo].[func_PathIsExists]...';


GO
CREATE FUNCTION [dbo].[func_PathIsExists]
(@directory NVARCHAR (4000))
RETURNS BIT
AS
 EXTERNAL NAME [icErp.CLR].[icErp.CLR.FileOperate].[func_PathIsExists]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
IF EXISTS (SELECT * FROM #tmpErrors) ROLLBACK TRANSACTION
GO
IF @@TRANCOUNT>0 BEGIN
PRINT N'数据库更新的事务处理部分成功。'
COMMIT TRANSACTION
END
ELSE PRINT N'数据库更新的事务处理部分失败。'
GO
DROP TABLE #tmpErrors
GO
